{% extends "base.html" %}
{% block content %}
  <div class="flex items-center justify-between">
    <h1 class="text-xl font-semibold">用户管理</h1>
    <a href="/admin" class="text-sm text-slate-600 underline">返回</a>
  </div>

  {% if msg %}
    <div class="mt-3 rounded-lg border bg-white p-3 text-sm text-slate-700">
      {{ msg }}
    </div>
  {% endif %}

  <div class="mt-4 rounded-xl border bg-white p-4">
    <div class="text-sm font-medium">创建用户</div>
    <form method="post" action="/admin/users/create" class="mt-3 space-y-3">
      <div>
        <label class="text-sm text-slate-600">用户名</label>
        <input name="username" class="mt-1 w-full rounded-lg border bg-white px-3 py-2" required />
      </div>
      <div>
        <label class="text-sm text-slate-600">密码</label>
        <input name="password" type="password" class="mt-1 w-full rounded-lg border bg-white px-3 py-2" required />
      </div>
      <div>
        <label class="text-sm text-slate-600">角色</label>
        <select name="role" class="mt-1 w-full rounded-lg border bg-white px-3 py-2">
          <option value="member">member（会员）</option>
          <option value="coach">coach（教练）</option>
          <option value="frontdesk">frontdesk（前台）</option>
          <option value="admin">admin（管理员）</option>
        </select>
      </div>
      <div>
        <label class="text-sm text-slate-600">显示名（会员/教练可选）</label>
        <input name="display_name" class="mt-1 w-full rounded-lg border bg-white px-3 py-2" />
      </div>
      <label class="flex items-center gap-2 text-sm text-slate-700">
        <input type="checkbox" name="enabled" checked disabled />
        启用
      </label>
      <button class="w-full rounded-lg bg-slate-900 px-3 py-2 text-white">创建</button>
    </form>
  </div>

  <div class="mt-4 space-y-2">
    {% for u in users %}
      <div class="rounded-xl border bg-white p-4">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-sm font-medium">{{ u.username }}</div>
            <div class="mt-1 text-xs text-slate-500">角色：{{ u.role.value }} · 状态：{% if u.is_active %}启用{% else %}禁用{% endif %}</div>
          </div>
          <form method="post" action="/admin/users/{{ u.id }}/toggle">
            <button class="rounded-lg border px-3 py-2 text-sm">{% if u.is_active %}禁用{% else %}启用{% endif %}</button>
          </form>
        </div>

        <form method="post" action="/admin/users/{{ u.id }}/reset_password" class="mt-3 flex gap-2">
          <input name="new_password" type="password" placeholder="新密码" class="flex-1 rounded-lg border bg-white px-3 py-2 text-sm" required />
          <button class="rounded-lg bg-slate-900 px-3 py-2 text-sm text-white">重置</button>
        </form>
      </div>
    {% endfor %}
  </div>
{% endblock %}
