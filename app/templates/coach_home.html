{% extends "base.html" %}
{% block content %}
  <div class="flex items-center justify-between">
    <h1 class="text-xl font-semibold">教练确认</h1>
    <a href="/logout" class="text-sm text-slate-600 underline">退出</a>
  </div>
  {% if msg %}
    <div class="mt-3 rounded-lg border bg-white p-3 text-sm text-slate-700">
      {{ msg }}
    </div>
  {% endif %}

  <form method="get" action="/coach" class="mt-4 space-y-3 rounded-xl border bg-white p-4">
    <div>
      <label class="text-sm text-slate-600">日期</label>
      <input name="date" type="date" value="{{ selected_date }}" class="mt-1 w-full rounded-lg border bg-white px-3 py-2" />
    </div>
    <button class="w-full rounded-lg bg-slate-900 px-3 py-2 text-white">查看预约</button>
  </form>

  <div class="mt-4 space-y-2">
    {% if not items %}
      <div class="rounded-xl border bg-white p-4 text-sm text-slate-700">当天暂无预约</div>
    {% endif %}
    {% for it in items %}
      <div class="rounded-xl border bg-white p-4">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-sm font-medium">{{ it.start_hm }} - {{ it.end_hm }}</div>
            <div class="mt-1 text-xs text-slate-500">会员：{{ it.member.display_name }}</div>
          </div>
          <div class="text-xs text-slate-600">{{ it.booking.status.value }}</div>
        </div>

        {% if it.booking.status == BookingStatus.pending %}
          <div class="mt-3 flex gap-2">
            <form method="post" action="/coach/bookings/{{ it.booking.id }}/confirm" class="flex-1">
              <button class="w-full rounded-lg bg-emerald-600 px-3 py-2 text-sm text-white">确认</button>
            </form>
            <form method="post" action="/coach/bookings/{{ it.booking.id }}/reject" class="flex-1">
              <input name="decision_note" placeholder="拒绝原因（可选）" class="mb-2 w-full rounded-lg border bg-white px-3 py-2 text-sm" />
              <button class="w-full rounded-lg bg-rose-600 px-3 py-2 text-sm text-white">拒绝</button>
            </form>
          </div>
        {% endif %}

        {% if it.booking.decision_note %}
          <div class="mt-2 text-xs text-slate-500">备注：{{ it.booking.decision_note }}</div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
{% endblock %}
